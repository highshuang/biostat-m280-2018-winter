---
title: "M280 Assignment2"
author: "Shuang Gao"
date: "2018/2/12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if (!"tidyverse" %in% rownames(installed.packages()))  
  install.packages("tidyverse", repos="http://cran.rstudio.com/")

if (!"nycflights13" %in% rownames(installed.packages()))  
  install.packages("nycflights13", repos="http://cran.rstudio.com/")
library(tidyverse)
library(nycflights13)

```

## Read Chapter 7 (Exploratory Data Analysis) of R for Data Science and do exercises 7.3.4, 7.4.1, 7.5.1.1, 7.5.2.1, and 7.5.3.1.

### 7.3.4
1. Explore the distribution of each of the x, y, and z variables in diamonds. What do you learn? Think about a diamond and how you might decide which dimension is the length, width, and depth.
```{r}
ggplot(data = diamonds) +
  geom_histogram(mapping = aes(x = x), binwidth = 0.5) +
  scale_x_continuous(breaks = seq(3.5, 10, by = 0.5)) +
  scale_y_continuous(breaks = seq(0, 14000, by = 2000)) +
  coord_cartesian(xlim = c(3.5, 10), ylim = c(0, 14000)) +
  labs(
    title = "histgram for x variable in diamonds",
    x = "x (mm)",
    y = "count of diamonds"
  )

ggplot(data = diamonds) +
  geom_histogram(mapping = aes(x = y), binwidth = 0.5) +
  scale_x_continuous(breaks = seq(3, 10, by = 0.5)) +
  scale_y_continuous(breaks = seq(0, 14000, by = 2000)) +
  coord_cartesian(xlim = c(3, 10), ylim = c(0,14000)) +
  labs(
    title = "histgram for y varibale in diamonds",
    x = "y (mm)",
    y = "count of diamonds"
  )
  
ggplot(data = diamonds) +
  geom_histogram(mapping = aes(x = z), binwidth = 0.5) +
  scale_x_continuous(breaks = seq(2, 7, by = 0.5)) +
  scale_y_continuous(breaks = seq(0, 14000, by = 2000)) +
  coord_cartesian(xlim = c(2,7), ylim = c(0,14000)) +
  labs(
    title = "histgram for z varibale in diamonds",
    x = "z (mm)",
    y = "count of diamonds"
  )

```
* For variable x in diamond, the range for x is from 3.75 to 9.75 mm, after excluding the outliers. For variable y in diamond, the range for y is from 3.75 to 9.75 mm, after excluding the outliers. For varibale z in diamond, the range for z is from 2.25 to 6.25 mm, after excluding the outliers. The range for x and y are similar, but the range for z is narrower. 

```{r}
ggplot(diamonds) +
  geom_point(aes(x = x, y = y), color = "darkgreen") +
  geom_point(aes(x = x, y = z), color = "blue") +
  coord_cartesian(xlim = c(2, 11), ylim = c(2, 11)) +
  labs(
    title = "the ratio between y and x, y and z",
    x = "variable x",
    y = "variable y or z"
  )
  

```
* From data on google, the ration between length and width is approximately 1 : 1. In the above graph, the green points show the ratio between y and x, and the blue points show the ratio between z and x. The approximate 1 to 1 ratio between y and x indicates x and y should be length and width.Comparing the above histgrams, the value of z is generally smaller than x and y. Considering the dimension of diamond, depth is relatively shorter than the other two. The ranges for x and y are relatively the same, it is hard to distinguish which one is width and which one is length.

2.Explore the distribution of price. Do you discover anything unusual or surprising? (Hint: Carefully think about the binwidth and make sure you try a wide range of values.)


```{r}
ggplot(diamonds) + 
  geom_freqpoly(aes(x = price), binwidth = 100) +
  labs(
    title = "the histgram for price with bindwidth = 100"
  )

```
* With binwidth 100, it is shown that as the price increases, the amount of diamonds increases fast first, and then decreases.The data set is positvely skewed. Diamonds with price around 1300 appear most. There is also an unusual decrease around 1500. Try limit the price range and identify the unusual situation.


```{r}
ggplot(diamonds) + 
  geom_freqpoly(aes(x = price), binwidth = 100) +
  coord_cartesian(xlim = c(1000, 3000))
  labs(
    title = "the histgram for price with bindwidth = 100 and price limit"
  )
ggplot(diamonds) + 
  geom_freqpoly(aes(x = price), binwidth = 10) +
  coord_cartesian(xlim = c(1000, 3000))
  labs(
    title = "the histgram for price with bindwidth = 10 and price limit"
  )
```

* By limiting the range of price to 1000-3000, it is clearly shown that there is a sharp decrease of diamond with price 1500. Try limiting the binwidth to 10. We see a flat line around 1500, which means there is no diamonds with price 1500 in this data set.

3.How many diamonds are 0.99 carat? How many are 1 carat? What do you think is the cause of the difference?

```{r}
carat.099 <- diamonds[diamonds$carat == 0.99, ]
carat.1 <- diamonds[diamonds$carat == 1, ]
if (nrow(carat.099) > nrow(carat.1)) {
  cat("There are more diamonds with 0.99 carat.")
}else {
  cat("There are more diamonds with 1 carat.")
}

cat("There are", nrow(carat.099), "0.99 carat diamonds")
cat("There are", nrow(carat.1), "1 carat diamonds")

# show distribution around 0.99 to 1 carat
ggplot(diamonds) + 
  geom_histogram(aes(x = carat), binwidth = 0.005) +
  scale_x_continuous(breaks = seq(0.97, 1.03, by = 0.01)) +
  coord_cartesian(xlim = c(0.97, 1.03)) +
  labs(
    title = "histgram for carat distribution limiting from 0.97 to 1.03"
  )


```
* From the data ranging from 0.97 to 1.03, there is barely no carat with 0.99 carat. Then there is a sudden increase to 1 carat diamonds. This is probably because people prefer 1 carat than 0.99 carat, since 1 carat diamonds raise a level from 0.99 carat.


4.Compare and contrast coord_cartesian() vs xlim() or ylim() when zooming in on a histgram. What happens if you leave binwidth unset? What happens if you try and zoom so only half a bar shows?

```{r}
ggplot(diamonds) + 
  geom_histogram(aes(x = price)) +
  xlim(c(2000, 4000)) +
  labs(
    title = "histgram of price with range 2000 to 4000 using xlim with default 
    binwidth"
  )

ggplot(diamonds) + 
  geom_histogram(aes(x = price)) +
  coord_cartesian(xlim = c(2000, 4000)) +
  labs(
    title = "histgram of price with range 2000 to 4000 using xlim with default 
    binwidth"
  )
```
* The default setting for binwidth is 30. However, the warning shows that R will automatically pick a better value for the data set.However, for the same data with the same range, the graphs show two different binwidth. Because, using coord_cartesian() will first plot with all the data points and then zoom in. Thus, by using the whole range of data, R will automatically pick a large binwidth. However, xlim() will cut the data with the given limit and then plot the histgram. Thus, R will automatically pick a relatively smaller binwidth according to the limited range. This operation difference can be further demonstrated in the following example.

```{r}
ggplot(diamonds) + 
  geom_histogram(aes(x = price), binwidth = 100) +
  xlim(c(2000, 4000)) +
  labs(
    title = "histgram of price with range 2000 to 4000 using xlim with bindwith
    = 100"
  )

ggplot(diamonds) + 
  geom_histogram(aes(x = price), binwidth = 100) +
  coord_cartesian(xlim = c(2000, 4000)) +
  labs(
    title = "histgram of price with range 2000 to 4000 using xlim with bindwith
    = 100"
  )
```
* In the above graphs, we set the binwidth to 100. When using xlim(), it cuts the data exactly in the range 2000 to 4000 first, and then plot the histgram. Therefore, there is no bar around 2000 and 4000. However, coord_cartesian() will plot first and cut the range. The bars around 2000 and 4000 are also shown in the graph.

###exercise 7.4.1
1. What happens to missing values in a histgram? What happens to missing values in a bar chart? Why is there a difference?

```{r}
# original distribution of y 
ggplot(diamonds) + 
  geom_histogram(aes(x = y), binwidth = 0.1) +
  coord_cartesian(xlim = c(0, 11)) +
  labs(
    title = "histgram of y with unusual values"
  )
diamonds2 <- diamonds %>% 
  mutate(y = ifelse(y < 3 | y > 20, NA, y))

diamonds.cut <- diamonds %>%
  mutate(cut = ifelse(cut == "Fair", "Fair",
        ifelse(cut == "Good", "Good",
        ifelse(cut == "Premium","Premium",
        ifelse(cut == "Ideal", "Ideal", NA)))))

ggplot(diamonds2, aes(x = y)) +
  geom_histogram( mapping = aes(x = y),  binwidth = 0.1) +
  coord_cartesian(xlim = c(0, 11)) +
  labs(
    title = "histgram of y with unusual values"
  )

ggplot(diamonds3, aes(x = cut)) +
  geom_bar( mapping = aes(x = cut))

```
* Comparing 

###7.5.1.1
1.Use what youâ€™ve learned to improve the visualisation of the departure times of cancelled vs. non-cancelled flights.
```{r}
library(nycflights13)
flights %>% mutate(cancell = ifelse(is.na(dep_time) |is.na(arr_time), "cancell",
                                    "not cancel")) %>% 
  ggplot() +
  geom_boxplot(aes(x = cancell, y = dep_time)) +
  labs(
    title = "boxplot for departure times of cancelled vs. non-cancelled 
    flights",
    x = "flight status",
    y = "departure time"
  )
```

2.What variable in the diamonds dataset is most important for predicting the price of a diamond? How is that variable correlated with cut? Why does the combination of those two relationships lead to lower quality diamonds being more expensive?
```{r}

```
















